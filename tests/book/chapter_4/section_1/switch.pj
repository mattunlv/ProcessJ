/**
 * ProcessJ Book code
 * Chapter 4
 * Section 1
 * Page 98
 */

import std.io;

public void switch1(chan<int>.read in, chan<int>.write out) {

    int x, input;

    input = in.read();

    switch(input) {

        case 1: x = 1; break;
        case 2: x = 2; break;
        default: x = 0; 

    }

    out.write(x);

}

public void switch2(chan<int>.read in, chan<int>.write out) {

    int x, input;

    input = in.read();

    switch(input) {

        case 1: x = 1;
        case 2: x = 2; break;
        default: x = 0;

    }

    out.write(x);

}

public void switch3(chan<int>.read in, chan<int>.write out) {

    int x = 0;
    int i = in.read();

    switch(i) {

        case 0:
        case 1: // we end here for both 0 and 1
            x = 1;
            break;
        case 2: // we end here for 2
            break;
        case 3:
        case 4: // we end here for 3 and 4
            x = 2;
        case 5: // we end here for 5
            x = 3;
            break;
        default: // all other numbers end here
           x = 4;
    }

}

public void main(string args[]) {

    chan<int> in, out;
    
    int result;

    par {

        in.write(1);
        switch1(in.read, out.write);
        
        result = out.read();

    }

    println("Switch 1 Result: " + result);

    par {

        in.write(2);
        switch1(in.read, out.write);

        result = out.read();

    }

    println("Switch 1 Result: " + result);

    par {

        in.write(1);
        switch2(in.read, out.write);

        result = out.read();

    }

    println("Switch 2 Result: " + result);

    par {

        in.write(2);
        switch2(in.read, out.write);

        result = out.read();

    }
    
    println("Switch 2 Result: " + result);

    par {

        in.write(45);
        switch2(in.read, out.write);

        result = out.read();

    }
    
    println("Switch 2 Result: " + result);

    for(int number = 0; number < 7; number++) {

        par { 

            in.write(number);
            switch3(in.read, out.write);
            result = out.read();

        }

        println("Switch 3 Result: " + result);

    }

}
