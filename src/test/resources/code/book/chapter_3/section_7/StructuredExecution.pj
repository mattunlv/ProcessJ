/**
 * ProcessJ Book Code
 * Chapter 3
 * Section 7.2
 * Page 72
 */

import std.*;

public void foo(chan<int>.read in, chan<int>.write out) {

    int x;
    int sum;

    seq {

        x   = in.read();
        sum = in.read();
        sum = sum + x;
        out.write(sum);

    }

}

public void bar(chan<int>.read in0, chan<int>.read in1, chan<int>.write out) {

    int x0, x1;
    int a, b, c;

    par {

        x1 = in1.read();
        x0 = in0.read();
        out.write(a + b);
        c = a + 2 * b;

    }

    println("[Bar]: Calculated " + c);

}

public void baz(chan<int>.read in, chan<int>.write out) {

    int sum;

    seq {

        out.write(42);
        out.write(42);
        sum = in.read();

    }

    println("[Baz]: Received: " + sum);

}

public void bazzy(chan<int>.write out0, chan<int>.write out1, chan<int>.read in) {

    int result;

    par {

        out0.write(56);
        out1.write(44);

        result = in.read();

    }

    println("[Bazzy]: Received: " + result);

}

public void main(string[] args) {

    chan<int> a, b, c;

    par {

        baz(a.read, a.write);
        foo(a.read, a.write);
    }

    par {

        bazzy(a.write, b.write, c.read);
        bar(a.read, b.read, c.write);

    }

}
